module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=37)}([function(e,t){e.exports=require("koa")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("date-fns")},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("koa-session")},function(e,t){e.exports=require("koa-compose")},function(e,t){e.exports=require("lodash")},function(e,t,n){"use strict";var r=n(23);n.o(r,"Locale")&&n.d(t,"Locale",function(){return r.Locale});var o=n(22);n.o(o,"Locale")&&n.d(t,"Locale",function(){return o.Locale});n(21);var a=n(20);n.o(a,"Locale")&&n.d(t,"Locale",function(){return a.Locale});var u=n(19);n.d(t,"Locale",function(){return u.a});n(18),n(17),n(16)},function(e,t){e.exports=require("path-to-regexp")},function(e,t){e.exports=require("accept-language")},function(e,t){e.exports=require("fs")},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n(15),n(14),n(13)},function(e,t){},function(e,t){},function(e,t,n){"use strict";var r;n.d(t,"a",function(){return r}),function(e){e.EN="en",e.ZH="zh"}(r||(r={}))},function(e,t){},function(e,t,n){"use strict";var r,o,a;!function(e){e.DASHBOARD="dashboard",e.CONTAINER="cubes",e.IMAGE="building",e.MIRROR="rocket",e.DOCS="file",e.LOCALE="globe"}(r||(r={})),function(e){e.DASHBOARD="dashboard",e.CONTAINER="container",e.APPLICATION="application",e.SERVICE="service",e.TEMPLATE="template",e.ENVFILE="envfile",e.CONFIGURATION="configuration",e.IMAGE="image",e.IMAGE_REPOSITORY="image-repository",e.SYNC_CENTER="sync-center",e.SYNC_HISTORY="sync-history",e.MIRROR="mirror",e.DOCS="docs",e.LOCALE="locale"}(o||(o={})),function(e){e.BOARD="board",e.DELIVERY="delivery",e.INFRASTRUCTURE="infrastructure",e.OPS="ops",e.APP_PLATFORM="app-platform",e.PLATFORM_EXTENSION="platform-extension",e.OTHERS="others"}(a||(a={}))},function(e,t){},function(e,t){},function(e,t){e.exports=require("captchapng2")},function(e,t){e.exports=require("koa-router")},function(e,t){e.exports=require("koa-bodyparser")},function(e,t){e.exports=require("qs")},function(e,t){e.exports=require("vue/package.json")},function(e,t){e.exports=require("koa/package.json")},function(e,t){e.exports=require("vue-server-renderer")},function(e,t){e.exports=require("mkdirp")},function(e,t){e.exports=require("lru-cache")},function(e,t){e.exports=require("koa-static-cache")},function(e,t){e.exports=require("koa-static")},function(e,t){e.exports=require("koa-logger")},function(e,t){e.exports=require("koa-compress")},function(e,t,n){"use strict";n.r(t);var r,o,a=n(12),u=n.n(a),i=n(3),s=n.n(i),c=n(11),l=n.n(c),f=n(2),p=n.n(f),d=n(0),h=n.n(d),y=(n(38),n(7)),b=n.n(y),v=n(36),E=n.n(v),R=n(35),O=n.n(R),g=n(6),m=n.n(g),S=n(34),T=n.n(S),C=n(33),A=n.n(C),P=n(32),_=n.n(P),x=n(31),w=n.n(x),I=n(10),N=n.n(I),k=n(30),L=n(29),j=n.n(L),D=n(28),q=n.n(D),U=process.env;function M(e,t,n){void 0===t&&(t="");var r=U[e];switch(t){case o.BOOLEAN:return r?"false"!==r:n||!1;case o.STR_ARR:return r?r.split(","):n||[];case o.KEY_VALUE:if(!r)return n||{};var a=r.split(":");return{key:a[0],value:a[1]};case o.KEY_VALUE_ARR:return r?r.split(",").map(function(e){var t=e.split(":");return{key:t[0],value:t[1]}}):n||[];default:return r||t}}!function(e){e.APP_KEYS="APP_KEYS",e.API_SERVER_URL="API_SERVER_URL",e.CCP_ACCOUNTSID="CCP_ACCOUNTSID",e.CCP_ACCOUNTTOKEN="CCP_ACCOUNTTOKEN",e.CCP_APPID="CCP_APPID",e.CCP_TEMPLATEID="CCP_TEMPLATEID",e.CCP_SERVERIP="CCP_SERVERIP",e.CCP_SERVERPORT="CCP_SERVERPORT",e.CCP_SOFTVERSION="CCP_SOFTVERSION",e.ENABLE_DEV_STATIC="ENABLE_DEV_STATIC",e.NON_SSR_PATTERN="NON_SSR_PATTERN",e.SMS_BASE_URL="SMS_BASE_URL",e.STATIC_PATTERN="STATIC_PATTERN",e.OUTPUT_JAKIRO_RESPONSE="OUTPUT_JAKIRO_RESPONSE"}(r||(r={})),function(e){e[e.BOOLEAN=0]="BOOLEAN",e[e.STR_ARR=1]="STR_ARR",e[e.KEY_VALUE=2]="KEY_VALUE",e[e.KEY_VALUE_ARR=3]="KEY_VALUE_ARR"}(o||(o={}));var V,Y={ACCOUNT_SID:M(r.CCP_ACCOUNTSID),ACCOUNT_TOKEN:M(r.CCP_ACCOUNTTOKEN),APP_ID:M(r.CCP_APPID),TEMPLATE_ID:M(r.CCP_TEMPLATEID),SERVER_IP:M(r.CCP_SERVERIP),SERVER_PORT:M(r.CCP_SERVERPORT),SOFT_VERSION:M(r.CCP_SOFTVERSION)},K={},F=new RegExp("^(/api)/"),H=n(5),B=n.n(H),G=n(27),z=n.n(G),J=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Z=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function u(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(u,i)}s((r=r.apply(e,t||[])).next())})},$=function(e,t){var n,r,o,a,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=r[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[0,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,r=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){u=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){u.label=a[1];break}if(6===a[0]&&u.label<o[1]){u.label=o[1],o=a;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(a);break}o[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(e,u)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}};!function(e){e.DELETE="delete",e.GET="get",e.HEAD="head",e.PATCH="patch",e.POST="post",e.PUT="put"}(V||(V={}));var W,X=p()("rubick:jakiro"),Q=M(r.API_SERVER_URL),ee=M(r.OUTPUT_JAKIRO_RESPONSE,o.BOOLEAN),te=function(e){var t=e.ctx,n=e.url,r=void 0===n?t.url:n,o=e.method,a=void 0===o?t.method:o,u=e.data,i=void 0===u?t.request.body:u,s=e.headers,c=e.params,l=void 0===c?t.query:c,f=e.qs;return Z(void 0,void 0,Promise,function(){var e,n,o,u,c,p,d,h;return $(this,function(y){switch(y.label){case 0:r=r.replace(F,"/"),r=Q+(/^\/v[12]/.test(r)?r:"/v1"+r),f&&(i=z.a.stringify(i)),e=t.session.user,s=J({},s,{"Alauda-Request-ID":t.get("alauda-request-id"),"User-Agent":"rubick/v1.0"}),e&&(s.Authorization="Token "+e.token),y.label=1;case 1:return y.trys.push([1,3,,4]),[4,B.a.request({url:r,method:a,data:i,params:l,headers:s})];case 2:return n=y.sent(),[3,4];case 3:return o=y.sent(),n={data:o.response.data,error:o.message,status:o.response.status},[3,4];case 4:if(u=n.data,c=u||{},!((p=n.status)>=400)||u&&u.errors||(c={code:"malformed_jakiro_response",source:"1019",error:n.error}),d="url:%s\nstatus:%d",h=[r,p],ee&&(d+="\nresult: %O",h.push(c)),X.apply(void 0,[d].concat(h)),c.errors&&(c.error=c.errors[0],c.code=c.error.code,delete c.errors),c.error)throw{result:c,status:p};return[2,{result:c,status:p}]}})})},ne=n(1),re=n.n(ne),oe=n(4),ae=Y.ACCOUNT_SID,ue=M(r.SMS_BASE_URL),ie=function(){return ue+"/2013-12-26/Accounts/"+ae+"/SMS/TemplateSMS?sig="+re.a.createHash("md5").update(""+ae+Y.ACCOUNT_TOKEN+Object(oe.format)(new Date,"YYYYMMDDHHmmss")).digest("hex").toUpperCase()},se=function(e,t){return B.a.post(ie(),{to:e,appId:Y.APP_ID,templateId:Y.TEMPLATE_ID,datas:[t,"60"]},{headers:{Accept:"application/json","Content-Type":"application/json;charset=utf-8",Authorization:new Buffer(ae+":"+Object(oe.format)(new Date,"YYYYMMDDHHmmss")).toString("base64")}})},ce=n(9),le=+process.env.PORT||4e3,fe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s.a.resolve.apply(s.a,[process.cwd()].concat(e))},pe=require,de=n(26),he=n.n(de),ye=n(25),be=n.n(ye),ve=[];!function(e){e.ALL="all",e.DELETE="delete",e.GET="get",e.HEAD="head",e.OPTIONS="options",e.PATCH="patch",e.POST="post",e.PUT="put"}(W||(W={}));var Ee=Symbol("routes"),Re=function(e){ve.push(e.prototype[Ee])};function Oe(e,t){"string"==typeof e||e instanceof RegExp?e={method:t,path:e}:void 0!==t&&console.warn("method should not be passed in");var n=e||{},r=n.method,o=Array.isArray(r)?r:[r],a=n.path;return function(e,t,n){(e=t?e:e.prototype)[Ee]||(e[Ee]=[]);var u=e[Ee];t?u.push({handler:n.value,method:o,path:a}):(r&&u.forEach(function(e){return e.method=e.method[0]?e.method:o}),u.path=a)}}var ge=function(e,t,n,r){var o,a=arguments.length,u=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,r);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(u=(a<3?o(u):a>3?o(t,n,u):o(t,n))||u);return a>3&&u&&Object.defineProperty(t,n,u),u},me=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Se=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function u(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(u,i)}s((r=r.apply(e,t||[])).next())})},Te=function(e,t){var n,r,o,a,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=r[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[0,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,r=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){u=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){u.label=a[1];break}if(6===a[0]&&u.label<o[1]){u.label=o[1],o=a;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(a);break}o[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(e,u)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}},Ce=(function(){function e(){}var t,n;e.prototype.commonCheck=function(e){return Se(this,void 0,void 0,function(){var t,n,r,o,a,u,i,s,c;return Te(this,function(l){switch(l.label){case 0:t=e.session.user,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,Promise.all([te({ctx:e,url:"/auth/profile"}),te({ctx:e,url:"/regions/"+t.namespace})])];case 2:return o=l.sent(),a=o[0].result,u=o[1].result,n=a,r=u,[3,4];case 3:return i=l.sent(),s=i.result,c=i.status,e.session=null,e.body=s,e.status=c,[2];case 4:return e.body={profile:n,regions:r},[2]}})})},e.prototype.logout=function(e){e.session=null,e.body=null},ge([Oe("/common"),me("design:type",Function),me("design:paramtypes",["function"==typeof(t=void 0!==d.Context&&d.Context)&&t||Object]),me("design:returntype",Promise)],e.prototype,"commonCheck",null),ge([Oe("/logout"),me("design:type",Function),me("design:paramtypes",["function"==typeof(n=void 0!==d.Context&&d.Context)&&n||Object]),me("design:returntype",void 0)],e.prototype,"logout",null),e=ge([Re],e)}(),n(24)),Ae=n.n(Ce),Pe=n(8),_e=function(e,t,n,r){var o,a=arguments.length,u=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,r);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(u=(a<3?o(u):a>3?o(t,n,u):o(t,n))||u);return a>3&&u&&Object.defineProperty(t,n,u),u},xe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},we=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function u(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(u,i)}s((r=r.apply(e,t||[])).next())})},Ie=function(e,t){var n,r,o,a,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=r[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[0,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,r=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){u=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){u.label=a[1];break}if(6===a[0]&&u.label<o[1]){u.label=o[1],o=a;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(a);break}o[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(e,u)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}},Ne=function(){return e=9e3*Math.random()+1e3,parseInt(e+"",10)+"";var e},ke=(function(){function e(){}var t,n,r,o;e.prototype.loginCheck=function(e){return we(this,void 0,void 0,function(){return Ie(this,function(t){return e.body=Object(Pe.omit)(e.session.user,"token"),[2]})})},e.prototype.login=function(e){return we(this,void 0,void 0,function(){var t,n,r,o,a,u,i;return Ie(this,function(s){switch(s.label){case 0:t=e.request,n=t.body,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,te({ctx:e,url:"/generate-api-token",headers:{CLIENT:e.ips.length?e.ips.join(", "):e.ip}})];case 2:return a=s.sent().result,r=a,[3,4];case 3:return o=s.sent(),a=o.result,u=o.status,e.body=a,e.status=u,[2];case 4:return e.user=e.session.user=r,[4,te({ctx:e,url:"/auth/"+(n.organization||n.username)+"/profile",method:V.GET})];case 5:return s.sent().result.password_is_empty?i="/user/password":n.next&&(i=n.next),e.body={url:i||"/",user:Object(Pe.omit)(r,"token")},[2]}})})},e.prototype.getCaptcha=function(e){var t,n=Ne();e.session.CAPTCHA_SESSION=n,e.type="image/png",e.body=(t=n,new Ae.a(80,30,t).getBuffer())},e.prototype.sendSms=function(e){return we(this,void 0,void 0,function(){var t,n;return Ie(this,function(r){switch(r.label){case 0:return e.session.CAPTCHA_SESSION!==e.request.body.captcha?(e.body={errors:[{code:"invalid_captcha"}]},e.status=401,[2]):(t=Ne(),n=e.request.body.mobile,[4,se(n,t)]);case 1:return r.sent(),e.cookies.set("VERIFICATION_CODE_COOKIE",re.a.createHash("md5").update(n+t).digest("hex"),{maxAge:36e5}),[2]}})})},_e([Oe("/login"),xe("design:type",Function),xe("design:paramtypes",["function"==typeof(t=void 0!==d.Context&&d.Context)&&t||Object]),xe("design:returntype",Promise)],e.prototype,"loginCheck",null),_e([Oe("/login",W.POST),xe("design:type",Function),xe("design:paramtypes",["function"==typeof(n=void 0!==d.Context&&d.Context)&&n||Object]),xe("design:returntype",Promise)],e.prototype,"login",null),_e([Oe("/captcha"),xe("design:type",Function),xe("design:paramtypes",["function"==typeof(r=void 0!==d.Context&&d.Context)&&r||Object]),xe("design:returntype",void 0)],e.prototype,"getCaptcha",null),_e([Oe("/sms",W.POST),xe("design:type",Function),xe("design:paramtypes",["function"==typeof(o=void 0!==d.Context&&d.Context)&&o||Object]),xe("design:returntype",Promise)],e.prototype,"sendSms",null),e=_e([Re],e)}(),function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function u(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(u,i)}s((r=r.apply(e,t||[])).next())})}),Le=function(e,t){var n,r,o,a,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=r[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[0,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,r=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){u=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){u.label=a[1];break}if(6===a[0]&&u.label<o[1]){u.label=o[1],o=a;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(a);break}o[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(e,u)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}},je=p()("rubick:server"),De=new be.a({prefix:"/api"});!function(e){for(var t=function(){var t=ve.shift();if(!t)return"continue";t.forEach(function(n){var r=n.handler,o=n.method,a=n.path,u=void 0===a?"":a;t.path&&"string"==typeof u&&(u=t.path+u),r=Array.isArray(r)?r:[r],o.forEach(function(t){var n;return(n=e)[t||W.GET].apply(n,[u].concat(r))})})};ve.length;)t()}(De);var qe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ue=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function u(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(u,i)}s((r=r.apply(e,t||[])).next())})},Me=function(e,t){var n,r,o,a,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=r[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[0,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,r=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){u=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){u.label=a[1];break}if(6===a[0]&&u.label<o[1]){u.label=o[1],o=a;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(a);break}o[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(e,u)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}};l.a.languages([ce.Locale.ZH,ce.Locale.EN]);var Ve,Ye,Ke,Fe,He,Be=p()("rubick:server"),Ge='<script src="/vendors.dll.'+pe(fe("dist/vendors.dll.manifest.json")).name.split("_")[1]+'.js"><\/script>',ze=u.a.readFileSync(fe("dist/template.html"),"utf-8"),Je=new h.a;Je.keys=M(r.APP_KEYS,o.STR_ARR),Je.use(b()([O()(),E()(),m()(K,Je)])),Ye=!!(Ve=Je),Ke=[he()(),De.routes(),De.allowedMethods(),function(e,t){return ke(void 0,void 0,void 0,function(){var n,r,o;return Le(this,function(a){switch(a.label){case 0:if(e.matched.length||!/^\/api/.test(e.url)||/\.[a-z]{2-4}\d?$/.test(e.path))return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,te({ctx:e})];case 2:return r=a.sent().result,e.body=r,[3,4];case 3:return n=a.sent(),r=n.result,o=n.status,e.body=r,e.status=o,[3,4];case 4:return[4,t()];case 5:return a.sent(),[2]}})})}],Ve||((Ve=new h.a).keys=M(r.APP_KEYS,o.STR_ARR),Ke.unshift(m()(K,Ve))),Ve.use(b()(Ke)),Ye||Ve.listen(le+1,"localhost",function(){je("Router server is now running at %s:%s.","localhost",le+1)});He=u.a,Ze=pe(fe("dist/vue-ssr-server-bundle.json")),$e={clientManifest:pe(fe("dist/vue-ssr-client-manifest.json"))},Fe=Object(k.createBundleRenderer)(Ze,qe({},$e,{template:ze,inject:!1,cache:_()({max:1e3,maxAge:9e5}),basedir:fe("dist/static"),runInNewContext:!1}));var Ze,$e,We={};Je.use(T()("dist/static",{defer:!0})).use(A()("dist/static",{maxAge:31536e3},We)),We["/service-worker.js"].maxAge=0;var Xe={"Content-Type":"text/html",Server:"koa/"+j.a.version+"; vue-server-renderer/"+q.a.version},Qe=M(r.NON_SSR_PATTERN,o.STR_ARR),et=M(r.STATIC_PATTERN,o.STR_ARR);Je.use(function(e,t){return Ue(void 0,void 0,void 0,function(){var n,r,o,a,u,i,c,f,p,d,h,y,b;return Me(this,function(v){switch(v.label){case 0:return"GET"!==e.method||null!=e.body||404!==e.status||/(^\/api\/)|(\.[a-z]{2,4}\d?$)/.test(e.path)?[4,t()]:[3,2];case 1:return v.sent(),[2];case 2:return[4,void 0];case 3:return v.sent(),n=e.cookies.get("LOCALE_COOKIE"),r=n||l.a.get(e.get("Accept-Language")),n||e.cookies.set("LOCALE_COOKIE",r,{httpOnly:!1,path:"/",expires:new Date("Fri, 31 Dec 9999 23:59:59 GMT")}),e.set(Xe),o=e.url,Qe.find(function(e){return"*"===e||!!N()(e).exec(o)})?[3,4]:[3,7];case 4:return e.url="__non-ssr-page__.html",[4,t()];case 5:v.sent(),v.label=6;case 6:return[2];case 7:return et.find(function(e){return!!N()(e).exec(o)})?(i=o.split("?")[0].replace(/^\//,"")||"home",c=i+"."+r+".html",f=e.hostname.endsWith(".now.sh"),u=f?s.a.resolve("/tmp",c):fe("dist/static/"+c),He.existsSync(u)?f?(e.body=He.createReadStream(u),[3,10]):[3,8]:[3,11]):[3,12];case 8:return e.url=c,[4,t()];case 9:v.sent(),v.label=10;case 10:return Be('using static html file "'+u+'"'),[2];case 11:a=!0,v.label=12;case 12:return p=Date.now(),d={ctx:e,locale:r,dllScript:Ge},h="",e.respond=!1,e.status=200,y=e.res,b=Fe.renderToStream(d).on("error",function(t){switch(e.status=t.status||500){case 302:return e.set({Location:t.url}),y.end();case 401:return e.redirect("/login?next="+o),y.end();case 404:return y.end("404 | Page Not Found");default:y.end("500 | Internal Server Error"),console.error("error during render : "+o),console.error(t.stack)}}).on("end",function(){if(h)try{w.a.sync(s.a.dirname(u),{fs:He}),He.writeFileSync(u,h),Be('static html file "'+u+'" is generated')}catch(e){console.error(e)}Be("whole request: "+(Date.now()-p)+"ms")}),a&&b.on("data",function(e){return h+=e}),b.pipe(y),[2]}})})}),Je.listen(le,"localhost",function(){return Be("Server is now running at %s:%s.","localhost",le)})},function(e,t){e.exports=require("koa-better-http-proxy")}]);