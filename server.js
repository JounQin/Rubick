module.exports=function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=11)}([function(e,t){e.exports=require("debug")},function(e,t,r){"use strict";var n,o=r(3),s=r(28);!function(e){e.DEV="development",e.PROD="production"}(n||(n={}));var i=process.env.HOST||"localhost",a=+process.env.PORT||4e3,u={NODE_ENV:"production","process.env.NODE_ENV":JSON.stringify("production"),__DEV__:"production"===n.DEV,__PROD__:"production"===n.PROD,NON_INDEX_REGEX:/^(?!.*[\/\\](index)\.ts).*\.(ts|vue)$/.toString(),I18N_REGEX:/([\w-]*[\w]+)\.i18n\.json$/.toString(),INNER_SERVER:JSON.stringify("http://localhost:"+a+"/"),API_PREFIX:JSON.stringify("/api")},c=function(){var e=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o.resolve.apply(o,[process.cwd()].concat(e))};return{base:e,src:e.bind(null,"src"),dist:e.bind(null,"dist"),server:e.bind(null,"server"),test:e.bind(null,"test")}}(),l=require,p={},f=["axios","regenerator-runtime/runtime","vue","vue-router","vue-translator","vuex"],d={serverHost:i,serverPort:a,quiet:!1,stats:{colors:!0,modules:!1,children:!1,chunks:!1,chunkModules:!1}},h=d,b=function(e){return{devTool:"cheap-module-eval-source-map",publicPath:"http://"+e.serverHost+":"+e.serverPort+"/",hashType:"hash"}},v=function(e){return{devTool:!1,serverHost:"localhost",publicPath:"/",hashType:"chunkhash"}};r.d(t,!1,function(){return s}),r.d(t,"b",function(){return u}),r.d(t,"c",function(){return c}),r.d(t,"d",function(){return l}),r.d(t,!1,function(){return p}),r.d(t,"e",function(){return f});var y=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},m={development:b,production:v};t.a=y({},h,m[u.NODE_ENV](h))},function(e,t){e.exports=require("webpack")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("koa")},function(e,t){e.exports=require("koa-compose")},function(e,t){e.exports=require("koa-session")},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("webpack-merge")},function(e,t,r){"use strict";var n=r(40),o=(r.n(n),r(41)),s=(r.n(o),r(2)),i=(r.n(s),r(1)),a=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},u=i.a.devTool,c=i.a.publicPath,l=i.b.__DEV__,p=i.b.__PROD__,f=!u,d=!f,h=n.extract({use:[{loader:"css-loader",options:{minimize:f&&{discardComments:{removeAll:!0}},sourceMap:d}},{loader:"postcss-loader",options:{sourceMap:d}},{loader:"resolve-url-loader",options:{sourceMap:d}},{loader:"sass-loader",options:{sourceMap:!0}},{loader:"sass-resources-loader",options:{resources:i.c.src("styles/_variables.scss")}}],fallback:"vue-style-loader"}),b={resolve:{modules:[i.c.src(),"node_modules"],extensions:[".ts",".vue",".js"]},output:{path:i.c.dist("static"),publicPath:c,filename:"[name].["+(p?"chunkhash":"hash")+"].js"},devtool:u,module:{rules:[{test:/\.ts$/,loader:"ts-loader",options:{appendTsSuffixTo:[/\.vue$/],compilerOptions:{module:"esnext",target:"es5"}}},{test:/\.vue$/,loader:"vue-loader",options:{cssModules:{camelCase:!0,localIdentName:p?"[hash:base64]":"[name]__[local]___[hash:base64:5]"},loaders:{scss:h}}},{test:/\.scss$/,use:h},{test:/\.(eot|svg|ttf|woff2?)$/,loader:"url-loader",options:{limit:8192}},{test:/\.pug$/,use:[{loader:"html-loader",options:{minimize:f}},"pug-html-loader"]}]},plugins:[new s.DefinePlugin(a({},i.b,{SERVER_PREFIX:JSON.stringify(i.a.publicPath)})),new s.SourceMapDevToolPlugin({test:/\.(css|js|ts)$/}),new n({filename:"app.[chunkhash].css",disable:l})].concat(p?[new s.optimize.ModuleConcatenationPlugin]:[new s.NoEmitOnErrorsPlugin,new o])};t.a=b},function(e,t,r){"use strict";function n(e,t,r){void 0===t&&(t="");var n=O[e];switch(t){case R.BOOLEAN:return n?"false"!==n:r||!1;case R.STR_ARR:return n?n.split(","):r||[];case R.KEY_VALUE:if(!n)return r||{};var o=n.split(":");return{key:o[0],value:o[1]};case R.KEY_VALUE_ARR:return n?n.split(",").map(function(e){var t=e.split(":");return{key:t[0],value:t[1]}}):r||[];default:return n||t}}function o(e,t){"string"==typeof e||e instanceof RegExp?e={method:t,path:e}:void 0!==t&&console.warn("method should not be passed in");var r=e||{},n=r.method,o=Array.isArray(n)?n:[n],s=r.path;return function(e,t,r){e=t?e:e.prototype,e[se]||(e[se]=[]);var i=e[se];t?i.push({handler:r.value,method:o,path:s}):(n&&i.forEach(function(e){return e.method=e.method[0]?e.method:o}),i.path=s)}}Object.defineProperty(t,"__esModule",{value:!0});var s,i=r(12),a=r(3),u=r(13),c=r.n(u),l=r(0),p=r(14),f=r(5),d=r(15),h=r(6),b=r(16),v=r(17),y=r(7),m=r(18),g=r(19),_=r(20),w=r(21),E=r(22),k=r(23),x=r(24),P=r(25),O=process.env;!function(e){e.APP_KEYS="APP_KEYS",e.API_SERVER_URL="API_SERVER_URL",e.CCP_ACCOUNTSID="CCP_ACCOUNTSID",e.CCP_ACCOUNTTOKEN="CCP_ACCOUNTTOKEN",e.CCP_APPID="CCP_APPID",e.CCP_TEMPLATEID="CCP_TEMPLATEID",e.CCP_SERVERIP="CCP_SERVERIP",e.CCP_SERVERPORT="CCP_SERVERPORT",e.CCP_SOFTVERSION="CCP_SOFTVERSION",e.ENABLE_DEV_STATIC="ENABLE_DEV_STATIC",e.NON_SSR_PATTERN="NON_SSR_PATTERN",e.SMS_BASE_URL="SMS_BASE_URL",e.STATIC_PATTERN="STATIC_PATTERN"}(s||(s={}));var R;!function(e){e[e.BOOLEAN=0]="BOOLEAN",e[e.STR_ARR=1]="STR_ARR",e[e.KEY_VALUE=2]="KEY_VALUE",e[e.KEY_VALUE_ARR=3]="KEY_VALUE_ARR"}(R||(R={}));var S,T={ACCOUNT_SID:n(s.CCP_ACCOUNTSID),ACCOUNT_TOKEN:n(s.CCP_ACCOUNTTOKEN),APP_ID:n(s.CCP_APPID),TEMPLATE_ID:n(s.CCP_TEMPLATEID),SERVER_IP:n(s.CCP_SERVERIP),SERVER_PORT:n(s.CCP_SERVERPORT),SOFT_VERSION:n(s.CCP_SOFTVERSION)},C={},A=new RegExp("^(/api)/"),N=r(8),I=r.n(N),D=r(26),q=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},j=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{u(n.next(e))}catch(e){s(e)}}function a(e){try{u(n.throw(e))}catch(e){s(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(i,a)}u((n=n.apply(e,t||[])).next())})},V=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,s&&(i=s[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(s,r[1])).done)return i;switch(s=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,s=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(i=u.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){u.label=r[1];break}if(6===r[0]&&u.label<i[1]){u.label=i[1],i=r;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(r);break}i[2]&&u.ops.pop(),u.trys.pop();continue}r=t.call(e,u)}catch(e){r=[6,e],s=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,s,i,a,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},L=this;!function(e){e.DELETE="delete",e.GET="get",e.HEAD="head",e.PATCH="patch",e.POST="post",e.PUT="put"}(S||(S={}));var M,U=l("rubick:jakiro"),H=function(e){var t=e.ctx,r=e.url,o=void 0===r?t.url:r,i=e.method,a=void 0===i?t.method:i,u=e.data,c=void 0===u?t.request.body:u,l=e.headers,p=e.params,f=void 0===p?t.query:p,d=e.qs;return j(L,void 0,void 0,function(){var e,r,i,u,p,h;return V(this,function(b){switch(b.label){case 0:o=o.replace(A,"/"),o=n(s.API_SERVER_URL)+(/^\/v[12]/.test(o)?o:"/v1"+o),d&&(c=D.stringify(c)),e=t.session.user,l=q({},l,{"Alauda-Request-ID":t.get("alauda-request-id"),"User-Agent":"rubick/v1.0"}),e&&(l.Authorization="Token "+e.token),b.label=1;case 1:return b.trys.push([1,3,,4]),[4,I.a.request({url:o,method:a,data:c,params:f,headers:l})];case 2:return r=b.sent(),[3,4];case 3:return i=b.sent(),r={data:i.response.data,error:i.message,status:i.response.status},[3,4];case 4:if(u=r.data,p=u||{},h=r.status,!(h>=400)||u&&u.errors||(p={code:"malformed_jakiro_response",source:"1019",error:r.error}),U("\nurl:%s\nresult: %O\nstatus:%d",o,p,h),p.errors&&(p.error=p.errors[0],p.code=p.error.code,delete p.errors),p.error)throw{result:p,status:h};return[2,{result:p,status:h}]}})})},F=r(4),Y=r(27),K=T.ACCOUNT_SID,B=n(s.SMS_BASE_URL),G=function(){return{Accept:"application/json","Content-Type":"application/json;charset=utf-8",Authorization:new Buffer(K+":"+Y().format("YYYYMMDDHHmmss")).toString("base64")}},J=function(){return F.createHash("md5").update(""+K+T.ACCOUNT_TOKEN+Y().format("YYYYMMDDHHmmss")).digest("hex")},$=function(){return B+"/2013-12-26/Accounts/"+K+"/SMS/TemplateSMS?sig="+J().toUpperCase()},z=function(e,t){return I.a.post($(),{to:e,appId:T.APP_ID,templateId:T.TEMPLATE_ID,datas:[t,"60"]},{headers:G()})};!function(e){e.DASHBOARD="dashboard",e.CONTAINER="cubes",e.MIRROR="rocket",e.DOCS="file",e.LOCALE="globe"}(M||(M={}));var W;!function(e){e.DASHBOARD="dashboard",e.CONTAINER="container",e.APPLICATION="application",e.SERVICE="service",e.TEMPLATE="template",e.ENVFILE="envfile",e.CONFIGURATION="configuration",e.MIRROR="mirror",e.DOCS="docs",e.LOCALE="locale"}(W||(W={}));var X;!function(e){e.BOARD="board",e.DELIVERY="delivery",e.INFRASTRUCTURE="infrastructure",e.OPS="ops",e.APP_PLATFORM="app-platform",e.PLATFORM_EXTENSION="platform-extension",e.OTHERS="others"}(X||(X={}));var Q;!function(e){e.EN="en",e.ZH="zh"}(Q||(Q={}));var Z,ee=function(e){return parseInt(e+"",10)},te=r(1),re=r(29),ne=r(30),oe=[];!function(e){e.ALL="all",e.DELETE="delete",e.GET="get",e.HEAD="head",e.OPTIONS="options",e.PATCH="patch",e.POST="post",e.PUT="put"}(Z||(Z={}));var se=Symbol("routes"),ie=function(e){oe.push(e.prototype[se])},ae=this&&this.__decorate||function(e,t,r,n){var o,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},ue=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ce=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{u(n.next(e))}catch(e){s(e)}}function a(e){try{u(n.throw(e))}catch(e){s(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(i,a)}u((n=n.apply(e,t||[])).next())})},le=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,s&&(i=s[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(s,r[1])).done)return i;switch(s=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,s=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(i=u.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){u.label=r[1];break}if(6===r[0]&&u.label<i[1]){u.label=i[1],i=r;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(r);break}i[2]&&u.ops.pop(),u.trys.pop();continue}r=t.call(e,u)}catch(e){r=[6,e],s=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,s,i,a,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},pe=(function(){function e(){}e.prototype.commonCheck=function(e){return ce(this,void 0,void 0,function(){var t,r,n,o,s,i,a,u,c;return le(this,function(l){switch(l.label){case 0:t=e.session.user,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,Promise.all([H({ctx:e,url:"/auth/profile"}),H({ctx:e,url:"/regions/"+t.namespace})])];case 2:return o=l.sent(),s=o[0].result,i=o[1].result,r=s,n=i,[3,4];case 3:return a=l.sent(),u=a.result,c=a.status,e.session=null,e.body=u,e.status=c,[2];case 4:return e.body={profile:r,regions:n},[2]}})})},e.prototype.logout=function(e){e.session=null,e.body=null},ae([o("/common"),ue("design:type",Function),ue("design:paramtypes",[Object]),ue("design:returntype",Promise)],e.prototype,"commonCheck",null),ae([o("/logout"),ue("design:type",Function),ue("design:paramtypes",[Object]),ue("design:returntype",void 0)],e.prototype,"logout",null),e=ae([ie],e)}(),r(31)),fe=r(32),de=this&&this.__decorate||function(e,t,r,n){var o,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},he=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},be=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{u(n.next(e))}catch(e){s(e)}}function a(e){try{u(n.throw(e))}catch(e){s(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(i,a)}u((n=n.apply(e,t||[])).next())})},ve=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,s&&(i=s[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(s,r[1])).done)return i;switch(s=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,s=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(i=u.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){u.label=r[1];break}if(6===r[0]&&u.label<i[1]){u.label=i[1],i=r;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(r);break}i[2]&&u.ops.pop(),u.trys.pop();continue}r=t.call(e,u)}catch(e){r=[6,e],s=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,s,i,a,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},ye=function(){return ee(9e3*Math.random()+1e3)+""},me=function(e){return new pe(80,30,e).getBuffer()},ge=(function(){function e(){}e.prototype.loginCheck=function(e){return be(this,void 0,void 0,function(){return ve(this,function(t){return e.body=Object(fe.omit)(e.session.user,"token"),[2]})})},e.prototype.login=function(e){return be(this,void 0,void 0,function(){var t,r,n,o,s,o,i,a,u;return ve(this,function(c){switch(c.label){case 0:t=e.request,r=t.body,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,H({ctx:e,url:"/generate-api-token",headers:{CLIENT:e.ips.length?e.ips.join(", "):e.ip}})];case 2:return o=c.sent().result,n=o,[3,4];case 3:return s=c.sent(),o=s.result,i=s.status,e.body=o,e.status=i,[2];case 4:return e.user=e.session.user=n,[4,H({ctx:e,url:"/auth/"+(r.organization||r.username)+"/profile",method:S.GET})];case 5:return a=c.sent().result,a.password_is_empty?u="/user/password":r.next&&(u=r.next),e.body={url:u||"/",user:Object(fe.omit)(n,"token")},[2]}})})},e.prototype.getCaptcha=function(e){var t=ye();e.session.CAPTCHA_SESSION=t,e.type="image/png",e.body=me(t)},e.prototype.sendSms=function(e){return be(this,void 0,void 0,function(){var t,r,n;return ve(this,function(o){switch(o.label){case 0:return(t=e.session.CAPTCHA_SESSION)!==e.request.body.captcha?(e.body={errors:[{code:"invalid_captcha"}]},e.status=401,[2]):(r=ye(),n=e.request.body.mobile,[4,z(n,r)]);case 1:return o.sent(),e.cookies.set("VERIFICATION_CODE_COOKIE",F.createHash("md5").update(n+r).digest("hex"),{maxAge:36e5}),[2]}})})},de([o("/login"),he("design:type",Function),he("design:paramtypes",[Object]),he("design:returntype",Promise)],e.prototype,"loginCheck",null),de([o("/login",Z.POST),he("design:type",Function),he("design:paramtypes",[Object]),he("design:returntype",Promise)],e.prototype,"login",null),de([o("/captcha"),he("design:type",Function),he("design:paramtypes",[Object]),he("design:returntype",void 0)],e.prototype,"getCaptcha",null),de([o("/sms",Z.POST),he("design:type",Function),he("design:paramtypes",[Object]),he("design:returntype",Promise)],e.prototype,"sendSms",null),e=de([ie],e)}(),this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{u(n.next(e))}catch(e){s(e)}}function a(e){try{u(n.throw(e))}catch(e){s(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(i,a)}u((n=n.apply(e,t||[])).next())})}),_e=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,s&&(i=s[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(s,r[1])).done)return i;switch(s=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,s=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(i=u.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){u.label=r[1];break}if(6===r[0]&&u.label<i[1]){u.label=i[1],i=r;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(r);break}i[2]&&u.ops.pop(),u.trys.pop();continue}r=t.call(e,u)}catch(e){r=[6,e],s=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,s,i,a,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},we=this,Ee=l("rubick:server"),ke=new ne({prefix:"/api"});!function(e){for(;oe.length;)!function(){var t=oe.shift();if(!t)return"continue";t.forEach(function(r){var n=r.handler,o=r.method,s=r.path,i=void 0===s?"":s;t.path&&"string"==typeof i&&(i=t.path+i),n=Array.isArray(n)?n:[n],o.forEach(function(t){return(r=e)[t||Z.GET].apply(r,[i].concat(n));var r})})}()}(ke);var xe=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},Pe=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{u(n.next(e))}catch(e){s(e)}}function a(e){try{u(n.throw(e))}catch(e){s(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(i,a)}u((n=n.apply(e,t||[])).next())})},Oe=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,s&&(i=s[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(s,r[1])).done)return i;switch(s=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,s=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(i=u.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){u.label=r[1];break}if(6===r[0]&&u.label<i[1]){u.label=i[1],i=r;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(r);break}i[2]&&u.ops.pop(),u.trys.pop();continue}r=t.call(e,u)}catch(e){r=[6,e],s=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,s,i,a,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},Re=this;c.a.languages([Q.ZH,Q.EN]);var Se=!te.a.devTool,Te=te.b.__DEV__,Ce=l("rubick:server"),Ae=te.a.serverHost,Ne=te.a.serverPort,Ie=function(e){var t=E.render(i.readFileSync(e,"utf-8"),{pretty:Se,polyfill:!Te});return Se?Object(p.minify)(t,{collapseWhitespace:!0,minifyJS:!0}):t},De=new f;De.keys=n(s.APP_KEYS,R.STR_ARR),De.use(h([v(),b(),y(C,De)])),Te?De.use(d(Ae,{port:Ne+1,preserveReqSession:!0,filter:function(e){return e.url.startsWith("/api")}})):function(e){var t=!!e,r=[re(),ke.routes(),ke.allowedMethods(),function(e,t){return ge(we,void 0,void 0,function(){var r,n,r,o;return _e(this,function(s){switch(s.label){case 0:if(e.matched.length||!/^\/api/.test(e.url)||/\.[a-z]{2-4}\d?$/.test(e.path))return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,H({ctx:e})];case 2:return r=s.sent().result,e.body=r,[3,4];case 3:return n=s.sent(),r=n.result,o=n.status,e.body=r,e.status=o,[3,4];case 4:return[4,t()];case 5:return s.sent(),[2]}})})}];if(e||(e=new f,e.keys=n(s.APP_KEYS,R.STR_ARR),r.unshift(y(C,e))),e.use(h(r)),!t){var o=te.a.serverHost,i=te.a.serverPort;e.listen(i+1,o,function(){Ee("Router server is now running at %s:%s.",o,i+1)})}}(De);var qe,je,Ve,Le=te.c.server("template.pug"),Me=function(e,t){return Object(k.createBundleRenderer)(e,xe({},t,{inject:!1,cache:g({max:1e3,maxAge:9e5}),basedir:te.c.dist("static"),runInNewContext:!1}))};Te?je=r(33).default(De,Le,Ie,function(e,t){var r=t.clientManifest,n=t.fs,o=t.template;qe=Me(e,{clientManifest:r,template:o}),Ve=n}):(Ve=i,qe=Me(Object(te.d)(te.c.dist("static/vue-ssr-server-bundle.json")),{clientManifest:Object(te.d)(te.c.dist("static/vue-ssr-client-manifest.json")),template:Ie(Le)}),De.use(m("dist/static",{defer:!0,maxage:31536e6})));var Ue=x.version,He=P.version,Fe={"Content-Type":"text/html",Server:"koa/"+Ue+"; vue-server-renderer/"+He},Ye=n(s.NON_SSR_PATTERN,R.STR_ARR),Ke=n(s.STATIC_PATTERN,R.STR_ARR);De.use(function(e,t){return Pe(Re,void 0,void 0,function(){var r,o,i,u,l,p,f,d,h,b,v,y,m;return Oe(this,function(g){switch(g.label){case 0:return"GET"!==e.method||null!=e.body||404!==e.status||/(^\/api\/)|(\.[a-z]{2,4}\d?$)/.test(e.path)?[2]:[4,je];case 1:return g.sent(),(r=e.cookies.get("LOCALE_COOKIE"),o=r||c.a.get(e.get("Accept-Language")),r||e.cookies.set("LOCALE_COOKIE",o,{httpOnly:!1,path:"/",expires:new Date("Fri, 31 Dec 9999 23:59:59 GMT")}),e.set(Fe),i=e.url,Ye.find(function(e){return!!w(e).exec(i)}))?Te?(e.body=Ve.createReadStream(te.c.dist("__non-ssr-page__.html")),[3,4]):[3,2]:[3,5];case 2:return e.url="__non-ssr-page__.html",[4,t()];case 3:g.sent(),g.label=4;case 4:return[2];case 5:return Te&&!n(s.ENABLE_DEV_STATIC,R.BOOLEAN)||!Ke.find(function(e){return!!w(e).exec(i)})?[3,10]:(p=i.split("?")[0].replace(/^\//,"")||"home",f="static/"+p+"."+o+".html",d=e.hostname.endsWith(".now.sh"),l=d?a.resolve("/tmp",f):te.c.dist(f),Ve.existsSync(l)?Te||d?(e.body=Ve.createReadStream(l),[3,8]):[3,6]:[3,9]);case 6:return e.url=f,[4,t()];case 7:g.sent(),g.label=8;case 8:return Ce('using static html file "'+l+'"'),[2];case 9:u=!0,g.label=10;case 10:return h=Date.now(),b={ctx:e,locale:o},v="",e.respond=!1,e.status=200,y=e.res,m=qe.renderToStream(b).on("error",function(t){switch(e.status=t.status||500){case 302:return e.redirect(t.url),y.end();case 401:return e.redirect("/login?next="+i),y.end();case 404:return y.end("404 | Page Not Found");default:y.end("500 | Internal Server Error"),console.error("error during render : "+i),console.error(t.stack)}}).on("end",function(){if(v)try{_.sync(a.dirname(l),{fs:Ve}),Ve.writeFileSync(l,v),Ce('static html file "'+l+'" is generated')}catch(e){console.error(e)}Ce("whole request: "+(Date.now()-h)+"ms")}),u&&m.on("data",function(e){return v+=e}),m.pipe(y),[2]}})})}),De.listen(Ne,Ae,function(){return Ce("Server is now running at %s:%s.",Ae,Ne)})},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("accept-language")},function(e,t){e.exports=require("html-minifier")},function(e,t){e.exports=require("koa-better-http-proxy")},function(e,t){e.exports=require("koa-compress")},function(e,t){e.exports=require("koa-logger")},function(e,t){e.exports=require("koa-static")},function(e,t){e.exports=require("lru-cache")},function(e,t){e.exports=require("mkdirp")},function(e,t){e.exports=require("path-to-regexp")},function(e,t){e.exports=require("pug")},function(e,t){e.exports=require("vue-server-renderer")},function(e,t){e.exports=require("koa/package.json")},function(e,t){e.exports=require("vue/package.json")},function(e,t){e.exports=require("qs")},function(e,t){e.exports=require("moment")},function(e,t){e.exports={name:"rubick",version:"0.0.1",description:"Alauda front end project Rubick built with Vue stack + TypeScript, just for study.",repository:"https://github.com/JounQin/Rubick.git",author:"JounQin <admin@1stg.me>",license:"MIT",private:!0,scripts:{"server:core":"env-cmd .env env-cmd --fallback .env.local ts-node -r tsconfig-paths/register server","server:router":"env-cmd .env env-cmd --fallback .env.local ts-node -r tsconfig-paths/register server/router/dev",watch:'nodemon --exec "npm run server:router"',dev:"run-p server:core watch",start:"env-cmd --fallback .env.local env-cmd .env node dist/server","build:server":"webpack --config build/webpack/server.ts --color --progress","build:vue:client":"webpack --config build/webpack/vue-client.ts --color --progress","build:vue:server":"webpack --config build/webpack/vue-server.ts --color --progress",build:"rimraf dist && env-cmd --fallback .env.local env-cmd .env run-p build:server build:vue:client build:vue:server","sync:pull":"bash build/bash/sync-pull.sh","sync:push":"bash build/bash/sync-push.sh",lint:"tslint -p . -e 'node_modules/**' -t stylish '**/*.ts'","lint:fix":"npm run lint -- --fix",precommit:"lint-staged",pm2:"bash build/bash/sync-pull.sh && pm2 start --name=rubick npm -- start",prune:"yarn install --production --ignore-optional --ignore-scripts --prefer-offline --force"},browserslist:["> 1% in CN"],"lint-staged":{"*.{json,md}":["prettier --write","git add"],"*.ts":["tslint -p . -t stylish --fix","git add"]},nodemonConfig:{ext:"ts",watch:[".env",".env.local","server/router"]},postcss:{autoprefixer:null},prettier:{semi:!1,singleQuote:!0,trailingComma:"all",overrides:[{files:"*.json",options:{printWidth:150}}]},dependencies:{"accept-language":"^3.0.18",axios:"^0.17.1",captchapng2:"^1.0.3",debug:"^3.1.0","env-cmd":"^7.0.0","html-minifier":"^3.5.7",koa:"^2.4.1","koa-better-http-proxy":"^0.2.4","koa-bodyparser":"^4.2.0","koa-compose":"^4.0.0","koa-compress":"^2.0.0","koa-logger":"^3.1.0","koa-router":"^7.3.0","koa-session":"^5.5.1","koa-static":"^4.0.2",lodash:"^4.17.4","lru-cache":"^4.1.1",mkdirp:"^0.5.1",moment:"^2.20.1","path-to-regexp":"^2.1.0",pug:"^2.0.0-rc.4",qs:"^6.5.1","regenerator-runtime":"^0.11.1","ts-node":"^4.0.2","tsconfig-paths":"^2.6.0","v-tooltip":"^2.0.0-rc.25",vue:"^2.5.13","vue-class-component":"^6.1.2","vue-property-decorator":"^6.0.0","vue-router":"^3.0.1","vue-server-renderer":"^2.5.13","vue-translator":"^0.5.1",vuex:"^3.0.1","vuex-class":"^0.3.0"},devDependencies:{"@types/chokidar":"^1.7.4","@types/debug":"^0.0.30","@types/extract-text-webpack-plugin":"^3.0.0","@types/friendly-errors-webpack-plugin":"^0.1.1","@types/html-webpack-plugin":"^2.30.1","@types/koa":"^2.0.43","@types/koa-bodyparser":"^3.0.26","@types/koa-compose":"^3.2.2","@types/koa-compress":"^2.0.8","@types/koa-logger":"^3.1.0","@types/koa-router":"^7.0.27","@types/koa-session":"^3.0.6","@types/koa-static":"^3.0.2","@types/lodash":"^4.14.91","@types/lru-cache":"^4.1.0","@types/memory-fs":"^0.3.0","@types/mkdirp":"^0.5.2","@types/node":"^8.5.2","@types/pug":"^2.0.4","@types/qs":"^6.5.1","@types/shelljs":"^0.7.7","@types/webpack":"^3.8.1","@types/webpack-dev-middleware":"^1.12.0","@types/webpack-hot-middleware":"^2.16.2","@types/webpack-merge":"^4.1.1","@types/webpack-node-externals":"^1.6.0",autoprefixer:"^7.2.3",chokidar:"^1.7.0","css-loader":"^0.28.7","extract-text-webpack-plugin":"^3.0.2","file-loader":"^1.1.6","font-awesome":"^4.7.0","fonts.css":"^1.5.0","friendly-errors-webpack-plugin":"^1.6.1","html-loader":"^0.5.1","html-webpack-plugin":"^2.30.1",husky:"^0.14.3","lint-staged":"^6.0.0","memory-fs":"^0.4.1","node-sass":"^4.7.2",nodemon:"^1.14.3","normalize.css":"^7.0.0","npm-run-all":"^4.1.2","postcss-loader":"^2.0.9",prettier:"^1.9.2","pug-html-loader":"^1.1.5","resolve-url-loader":"^2.2.1",rimraf:"^2.6.2","sass-loader":"^6.0.6","sass-resources-loader":"^1.3.1",shelljs:"^0.7.8","sw-precache-webpack-plugin":"^0.11.4","ts-loader":"^3.2.0",tslint:"^5.8.0","tslint-config-prettier":"^1.6.0","tslint-plugin-prettier":"^1.3.0",typescript:"^2.6.2","url-loader":"^0.6.2","vue-loader":"^13.6.1","vue-template-compiler":"^2.5.13",webpack:"^3.10.0","webpack-dev-middleware":"^2.0.3","webpack-hot-middleware":"^2.21.0","webpack-merge":"^4.1.1","webpack-node-externals":"^1.6.0"}}},function(e,t){e.exports=require("koa-bodyparser")},function(e,t){e.exports=require("koa-router")},function(e,t){e.exports=require("captchapng2")},function(e,t){e.exports=require("lodash")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(34),o=r(0),s=r(35),i=r(2),a=r(36),u=r(1),c=r(37),l=r(38),p=r(39),f=r(9),d=r(10),h=u.a.devTool,b=u.b.__DEV__,v=u.b.NODE_ENV,y=o("rubick:webpack:client");y("create webpack configuration for NODE_ENV:"+v+", VUE_ENV:client");var m=f.smart(d.a,{entry:{app:[u.c.src("entry-client.ts")],vendors:u.e},target:"web",plugins:[new i.DefinePlugin({"process.env.VUE_ENV":JSON.stringify("client"),__SERVER__:JSON.stringify(!1)}),new i.optimize.CommonsChunkPlugin({name:"vendors"}),new i.optimize.CommonsChunkPlugin({name:"manifest"}),new c({template:"src/index.pug",filename:"__non-ssr-page__.html",favicon:"src/assets/favicon.ico"}),new p]});h||(y("Enable plugins for "+v+" (UglifyJS)."),m.plugins.push(new i.optimize.UglifyJsPlugin({comments:!1}))),b?(m.entry.app.unshift("webpack-hot-middleware/client"),m.plugins.push(new i.HotModuleReplacementPlugin,new i.NoEmitOnErrorsPlugin)):(y("Enable plugins for "+v+" (SWPrecache)."),m.plugins.push(new l({cacheId:"rubick",filename:"service-worker.js",minify:!0,dontCacheBustUrlsMatching:/./,staticFileGlobsIgnorePatterns:[/index\.html$/,/\.map$/,/\.json$/],stripPrefix:u.c.dist().replace(/\\/g,"/"),runtimeCaching:[{urlPattern:/\//,handler:"networkFirst"}]})));var g=m,_=r(42),w=function(e,t,r){var n=r.end;return new Promise(function(o){r.end=function(){n.apply(this,arguments),o(!1)},e(t,r,function(){return o(!0)})})},E=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{u(n.next(e))}catch(e){s(e)}}function a(e){try{u(n.throw(e))}catch(e){s(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(i,a)}u((n=n.apply(e,t||[])).next())})},k=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,s&&(i=s[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(s,r[1])).done)return i;switch(s=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,s=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(i=u.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){u.label=r[1];break}if(6===r[0]&&u.label<i[1]){u.label=i[1],i=r;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(r);break}i[2]&&u.ops.pop(),u.trys.pop();continue}r=t.call(e,u)}catch(e){r=[6,e],s=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,s,i,a,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},x=this,P=o("rubick:webpack-dev"),O=function(e,t){return P("Enable webpack dev middleware."),function(e,r){return E(x,void 0,void 0,function(){var n;return k(this,function(o){switch(o.label){case 0:return[4,w(t,e.req,{end:function(t){e.body=t},setHeader:function(t,r){e.set(t,r)}})];case 1:return n=o.sent(),n?[4,r()]:[3,3];case 2:o.sent(),o.label=3;case 3:return[2]}})})}},R=r(45),S=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{u(n.next(e))}catch(e){s(e)}}function a(e){try{u(n.throw(e))}catch(e){s(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(i,a)}u((n=n.apply(e,t||[])).next())})},T=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,s&&(i=s[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(s,r[1])).done)return i;switch(s=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,s=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(i=u.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){u.label=r[1];break}if(6===r[0]&&u.label<i[1]){u.label=i[1],i=r;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(r);break}i[2]&&u.ops.pop(),u.trys.pop();continue}r=t.call(e,u)}catch(e){r=[6,e],s=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,s,i,a,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},C=this,A=o("rubick:webpack-hmr"),N=function(e){A("Enable Webpack Hot Module Replacement (HMR).");var t=R(e,{heartbeat:5e3});return function(e,r){return S(C,void 0,void 0,function(){var n;return T(this,function(o){switch(o.label){case 0:return[4,w(t,e.req,e.res)];case 1:return n=o.sent(),n?[4,r()]:[3,3];case 2:o.sent(),o.label=3;case 3:return[2]}})})}},I=o("rubick:server"),D=function(e,t){return e.readFileSync(u.c.dist("static/"+t),"utf-8")};t.default=function(e,t,r,o){var c,l,p,f,d,h=new Promise(function(e){d=e}),b=function(){c&&l&&(d(),o(c,{fs:p,template:f,clientManifest:l}))};f=r(t),Object(n.watch)(t).on("change",function(){f=r(t),I("pug template updated."),b()});var v=i(g),y=a(v,{publicPath:u.a.publicPath,quiet:u.a.quiet,noInfo:u.a.quiet,lazy:!1,stats:u.a.stats});v.plugin("done",function(e){e=e.toJson(),e.errors.forEach(console.error),e.warnings.forEach(console.warn),e.errors.length||(p=y.fileSystem,l=JSON.parse(D(p,"vue-ssr-client-manifest.json")),b())}),e.use(O(0,y)).use(N(v));var m=new s,w=i(_.a);return w.outputFileSystem=m,w.watch({},function(e,t){if(e)throw e;t.toJson().errors.length||(c=JSON.parse(D(m,"vue-ssr-server-bundle.json")),b())}),h}},function(e,t){e.exports=require("chokidar")},function(e,t){e.exports=require("memory-fs")},function(e,t){e.exports=require("webpack-dev-middleware")},function(e,t){e.exports=require("html-webpack-plugin")},function(e,t){e.exports=require("sw-precache-webpack-plugin")},function(e,t){e.exports=require("vue-server-renderer/client-plugin")},function(e,t){e.exports=require("extract-text-webpack-plugin")},function(e,t){e.exports=require("friendly-errors-webpack-plugin")},function(e,t,r){"use strict";(function(e){var n=r(3),o=(r.n(n),r(0)),s=(r.n(o),r(43)),i=(r.n(s),r(2)),a=(r.n(i),r(9)),u=(r.n(a),r(44)),c=(r.n(u),r(1)),l=r(10),p=c.b.NODE_ENV;o("rubick:webpack:server")("create webpack configuration for NODE_ENV:"+p+", VUE_ENV:server"),t.a=a.smart(l.a,{entry:[n.resolve(e,"element.js"),c.c.src("entry-server.ts")],target:"node",output:{filename:"server-bundle.js",libraryTarget:"commonjs2"},plugins:[new i.DefinePlugin({"process.env.VUE_ENV":JSON.stringify("server"),__SERVER__:JSON.stringify(!0)}),new s],externals:u({whitelist:[/\.css$/]})})}).call(t,"/")},function(e,t){e.exports=require("vue-server-renderer/server-plugin")},function(e,t){e.exports=require("webpack-node-externals")},function(e,t){e.exports=require("webpack-hot-middleware")}]);