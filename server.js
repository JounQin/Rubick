module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=38)}([function(e,t){e.exports=require("koa")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("date-fns")},function(e,t){e.exports=require("koa-compose")},function(e,t){e.exports=require("koa-session")},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("accept-language")},function(e,t){e.exports=require("path-to-regexp")},function(e,t,n){"use strict";var r=n(13);n.o(r,"Locale")&&n.d(t,"Locale",function(){return r.Locale});var o=n(14);n.o(o,"Locale")&&n.d(t,"Locale",function(){return o.Locale});n(15);var u=n(16);n.o(u,"Locale")&&n.d(t,"Locale",function(){return u.Locale});var a=n(17);n.d(t,"Locale",function(){return a.a});n(18),n(19),n(20)},function(e,t){e.exports=require("lodash")},function(e,t){},function(e,t){},function(e,t,n){"use strict";var r,o,u;!function(e){e.DASHBOARD="dashboard",e.CONTAINER="cubes",e.IMAGE="building",e.MIRROR="rocket",e.DOCS="file",e.LOCALE="globe"}(r||(r={})),function(e){e.DASHBOARD="dashboard",e.CONTAINER="container",e.APPLICATION="application",e.SERVICE="service",e.TEMPLATE="template",e.ENVFILE="envfile",e.CONFIGURATION="configuration",e.IMAGE="image",e.IMAGE_REPOSITORY="image-repository",e.SYNC_CENTER="sync-center",e.SYNC_HISTORY="sync-history",e.MIRROR="mirror",e.DOCS="docs",e.LOCALE="locale"}(o||(o={})),function(e){e.BOARD="board",e.DELIVERY="delivery",e.INFRASTRUCTURE="infrastructure",e.OPS="ops",e.APP_PLATFORM="app-platform",e.PLATFORM_EXTENSION="platform-extension",e.OTHERS="others"}(u||(u={}))},function(e,t){},function(e,t,n){"use strict";var r;n.d(t,"a",function(){return r}),function(e){e.EN="en",e.ZH="zh"}(r||(r={}))},function(e,t){},function(e,t){},function(e,t,n){"use strict";n(21),n(22),n(23)},function(e,t){},function(e,t){},function(e,t){},function(e,t){e.exports=require("koa-compress")},function(e,t){e.exports=require("koa-logger")},function(e,t){e.exports=require("koa-static")},function(e,t){e.exports=require("koa-static-cache")},function(e,t){e.exports=require("lru-cache")},function(e,t){e.exports=require("mkdirp")},function(e,t){e.exports=require("vue-server-renderer")},function(e,t){e.exports=require("koa/package.json")},function(e,t){e.exports=require("vue/package.json")},function(e,t){e.exports=require("qs")},function(e,t){e.exports=require("koa-bodyparser")},function(e,t){e.exports=require("koa-router")},function(e,t){e.exports=require("captchapng2")},function(e,t){e.exports=require("koa-better-http-proxy")},function(e,t,n){"use strict";n.r(t);var r,o,u=n(8),a=n.n(u),i=n(3),s=n.n(i),c=n(9),l=n.n(c),f=n(2),p=n.n(f),d=n(0),h=n.n(d),y=(n(37),n(5)),b=n.n(y),v=n(24),E=n.n(v),R=n(25),O=n.n(R),m=n(6),g=n.n(m),S=n(26),T=n.n(S),C=n(27),A=n.n(C),P=n(28),_=n.n(P),x=n(29),w=n.n(x),I=n(10),N=n.n(I),k=n(30),L=n(31),j=n.n(L),D=n(32),q=n.n(D),U=process.env;function M(e,t,n){void 0===t&&(t="");var r=U[e];switch(t){case o.BOOLEAN:return r?"false"!==r:n||!1;case o.STR_ARR:return r?r.split(","):n||[];case o.KEY_VALUE:if(!r)return n||{};var u=r.split(":");return{key:u[0],value:u[1]};case o.KEY_VALUE_ARR:return r?r.split(",").map(function(e){var t=e.split(":");return{key:t[0],value:t[1]}}):n||[];default:return r||t}}!function(e){e.APP_KEYS="APP_KEYS",e.API_SERVER_URL="API_SERVER_URL",e.CCP_ACCOUNTSID="CCP_ACCOUNTSID",e.CCP_ACCOUNTTOKEN="CCP_ACCOUNTTOKEN",e.CCP_APPID="CCP_APPID",e.CCP_TEMPLATEID="CCP_TEMPLATEID",e.CCP_SERVERIP="CCP_SERVERIP",e.CCP_SERVERPORT="CCP_SERVERPORT",e.CCP_SOFTVERSION="CCP_SOFTVERSION",e.ENABLE_DEV_STATIC="ENABLE_DEV_STATIC",e.NON_SSR_PATTERN="NON_SSR_PATTERN",e.SMS_BASE_URL="SMS_BASE_URL",e.STATIC_PATTERN="STATIC_PATTERN",e.OUTPUT_JAKIRO_RESPONSE="OUTPUT_JAKIRO_RESPONSE"}(r||(r={})),function(e){e[e.BOOLEAN=0]="BOOLEAN",e[e.STR_ARR=1]="STR_ARR",e[e.KEY_VALUE=2]="KEY_VALUE",e[e.KEY_VALUE_ARR=3]="KEY_VALUE_ARR"}(o||(o={}));var V,Y={ACCOUNT_SID:M(r.CCP_ACCOUNTSID),ACCOUNT_TOKEN:M(r.CCP_ACCOUNTTOKEN),APP_ID:M(r.CCP_APPID),TEMPLATE_ID:M(r.CCP_TEMPLATEID),SERVER_IP:M(r.CCP_SERVERIP),SERVER_PORT:M(r.CCP_SERVERPORT),SOFT_VERSION:M(r.CCP_SOFTVERSION)},K={},F=new RegExp("^(/api)/"),H=n(7),B=n.n(H),G=n(33),z=n.n(G),J=function(){return(J=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Z=function(e,t,n,r){return new(n||(n=Promise))(function(o,u){function a(e){try{s(r.next(e))}catch(e){u(e)}}function i(e){try{s(r.throw(e))}catch(e){u(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,i)}s((r=r.apply(e,t||[])).next())})},$=function(e,t){var n,r,o,u,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===u[0]||2===u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}};!function(e){e.DELETE="delete",e.GET="get",e.HEAD="head",e.PATCH="patch",e.POST="post",e.PUT="put"}(V||(V={}));var W,X=p()("rubick:jakiro"),Q=M(r.API_SERVER_URL),ee=M(r.OUTPUT_JAKIRO_RESPONSE,o.BOOLEAN),te=function(e){var t=e.ctx,n=e.url,r=void 0===n?t.url:n,o=e.method,u=void 0===o?t.method:o,a=e.data,i=void 0===a?t.request.body:a,s=e.headers,c=e.params,l=void 0===c?t.query:c,f=e.qs;return Z(void 0,void 0,Promise,function(){var e,n,o,a,c,p,d,h;return $(this,function(y){switch(y.label){case 0:r=r.replace(F,"/"),r=Q+(/^\/v[12]/.test(r)?r:"/v1"+r),f&&(i=z.a.stringify(i)),e=t.session.user,s=J({},s,{"Alauda-Request-ID":t.get("alauda-request-id"),"User-Agent":"rubick/v1.0"}),e&&(s.Authorization="Token "+e.token),y.label=1;case 1:return y.trys.push([1,3,,4]),[4,B.a.request({url:r,method:u,data:i,params:l,headers:s})];case 2:return n=y.sent(),[3,4];case 3:return o=y.sent(),n={data:o.response.data,error:o.message,status:o.response.status},[3,4];case 4:if(a=n.data,c=a||{},!((p=n.status)>=400)||a&&a.errors||(c={code:"malformed_jakiro_response",source:"1019",error:n.error}),d="url:%s\nstatus:%d",h=[r,p],ee&&(d+="\nresult: %O",h.push(c)),X.apply(void 0,[d].concat(h)),c.errors&&(c.error=c.errors[0],c.code=c.error.code,delete c.errors),c.error)throw{result:c,status:p};return[2,{result:c,status:p}]}})})},ne=n(1),re=n.n(ne),oe=n(4),ue=Y.ACCOUNT_SID,ae=M(r.SMS_BASE_URL),ie=function(){return ae+"/2013-12-26/Accounts/"+ue+"/SMS/TemplateSMS?sig="+re.a.createHash("md5").update(""+ue+Y.ACCOUNT_TOKEN+Object(oe.format)(new Date,"YYYYMMDDHHmmss")).digest("hex").toUpperCase()},se=function(e,t){return B.a.post(ie(),{to:e,appId:Y.APP_ID,templateId:Y.TEMPLATE_ID,datas:[t,"60"]},{headers:{Accept:"application/json","Content-Type":"application/json;charset=utf-8",Authorization:new Buffer(ue+":"+Object(oe.format)(new Date,"YYYYMMDDHHmmss")).toString("base64")}})},ce=n(11),le=+process.env.PORT||4e3,fe=s.a.resolve,pe=require,de=n(34),he=n.n(de),ye=n(35),be=n.n(ye),ve=[];!function(e){e.ALL="all",e.DELETE="delete",e.GET="get",e.HEAD="head",e.OPTIONS="options",e.PATCH="patch",e.POST="post",e.PUT="put"}(W||(W={}));var Ee=Symbol("routes"),Re=function(e){ve.push(e.prototype[Ee])};function Oe(e,t){"string"==typeof e||e instanceof RegExp?e={method:t,path:e}:void 0!==t&&console.warn("method should not be passed in");var n=e||{},r=n.method,o=Array.isArray(r)?r:[r],u=n.path;return function(e,t,n){(e=t?e:e.prototype)[Ee]||(e[Ee]=[]);var a=e[Ee];t?a.push({handler:n.value,method:o,path:u}):(r&&a.forEach(function(e){return e.method=e.method[0]?e.method:o}),a.path=u)}}var me=function(e,t,n,r){var o,u=arguments.length,a=u<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(a=(u<3?o(a):u>3?o(t,n,a):o(t,n))||a);return u>3&&a&&Object.defineProperty(t,n,a),a},ge=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Se=function(e,t,n,r){return new(n||(n=Promise))(function(o,u){function a(e){try{s(r.next(e))}catch(e){u(e)}}function i(e){try{s(r.throw(e))}catch(e){u(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,i)}s((r=r.apply(e,t||[])).next())})},Te=function(e,t){var n,r,o,u,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===u[0]||2===u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}},Ce=(function(){function e(){}var t,n;e.prototype.commonCheck=function(e){return Se(this,void 0,void 0,function(){var t,n,r,o,u,a,i,s,c;return Te(this,function(l){switch(l.label){case 0:t=e.session.user,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,Promise.all([te({ctx:e,url:"/auth/profile"}),te({ctx:e,url:"/regions/"+t.namespace})])];case 2:return o=l.sent(),u=o[0].result,a=o[1].result,n=u,r=a,[3,4];case 3:return i=l.sent(),s=i.result,c=i.status,e.session=null,e.body=s,e.status=c,[2];case 4:return e.body={profile:n,regions:r},[2]}})})},e.prototype.logout=function(e){e.session=null,e.body=null},me([Oe("/common"),ge("design:type",Function),ge("design:paramtypes",["function"==typeof(t=void 0!==d.Context&&d.Context)?t:Object]),ge("design:returntype",Promise)],e.prototype,"commonCheck",null),me([Oe("/logout"),ge("design:type",Function),ge("design:paramtypes",["function"==typeof(n=void 0!==d.Context&&d.Context)?n:Object]),ge("design:returntype",void 0)],e.prototype,"logout",null),e=me([Re],e)}(),n(36)),Ae=n.n(Ce),Pe=n(12),_e=function(e,t,n,r){var o,u=arguments.length,a=u<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(a=(u<3?o(a):u>3?o(t,n,a):o(t,n))||a);return u>3&&a&&Object.defineProperty(t,n,a),a},xe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},we=function(e,t,n,r){return new(n||(n=Promise))(function(o,u){function a(e){try{s(r.next(e))}catch(e){u(e)}}function i(e){try{s(r.throw(e))}catch(e){u(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,i)}s((r=r.apply(e,t||[])).next())})},Ie=function(e,t){var n,r,o,u,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===u[0]||2===u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}},Ne=function(){return function(e){return parseInt(e+"",10)}(9e3*Math.random()+1e3)+""},ke=(function(){function e(){}var t,n,r,o;e.prototype.loginCheck=function(e){return we(this,void 0,void 0,function(){return Ie(this,function(t){return e.body=Object(Pe.omit)(e.session.user,"token"),[2]})})},e.prototype.login=function(e){return we(this,void 0,void 0,function(){var t,n,r,o,u,a,i;return Ie(this,function(s){switch(s.label){case 0:t=e.request,n=t.body,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,te({ctx:e,url:"/generate-api-token",headers:{CLIENT:e.ips.length?e.ips.join(", "):e.ip}})];case 2:return u=s.sent().result,r=u,[3,4];case 3:return o=s.sent(),u=o.result,a=o.status,e.body=u,e.status=a,[2];case 4:return e.session.user=r,[4,te({ctx:e,url:"/auth/"+(n.organization||n.username)+"/profile",method:V.GET})];case 5:return s.sent().result.password_is_empty?i="/user/password":n.next&&(i=n.next),e.body={url:i||"/",user:Object(Pe.omit)(r,"token")},[2]}})})},e.prototype.getCaptcha=function(e){var t=Ne();e.session.CAPTCHA_SESSION=t,e.type="image/png",e.body=function(e){return new Ae.a(80,30,e).getBuffer()}(t)},e.prototype.sendSms=function(e){return we(this,void 0,void 0,function(){var t,n,r,o;return Ie(this,function(u){switch(u.label){case 0:return t=e.session.CAPTCHA_SESSION,n=e.request.body,t!==n.captcha?(e.body={errors:[{code:"invalid_captcha"}]},e.status=401,[2]):(r=Ne(),o=n.mobile,[4,se(o,r)]);case 1:return u.sent(),e.cookies.set("VERIFICATION_CODE_COOKIE",re.a.createHash("md5").update(o+r).digest("hex"),{maxAge:36e5}),[2]}})})},_e([Oe("/login"),xe("design:type",Function),xe("design:paramtypes",["function"==typeof(t=void 0!==d.Context&&d.Context)?t:Object]),xe("design:returntype",Promise)],e.prototype,"loginCheck",null),_e([Oe("/login",W.POST),xe("design:type",Function),xe("design:paramtypes",["function"==typeof(n=void 0!==d.Context&&d.Context)?n:Object]),xe("design:returntype",Promise)],e.prototype,"login",null),_e([Oe("/captcha"),xe("design:type",Function),xe("design:paramtypes",["function"==typeof(r=void 0!==d.Context&&d.Context)?r:Object]),xe("design:returntype",void 0)],e.prototype,"getCaptcha",null),_e([Oe("/sms",W.POST),xe("design:type",Function),xe("design:paramtypes",["function"==typeof(o=void 0!==d.Context&&d.Context)?o:Object]),xe("design:returntype",Promise)],e.prototype,"sendSms",null),e=_e([Re],e)}(),function(e,t,n,r){return new(n||(n=Promise))(function(o,u){function a(e){try{s(r.next(e))}catch(e){u(e)}}function i(e){try{s(r.throw(e))}catch(e){u(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,i)}s((r=r.apply(e,t||[])).next())})}),Le=function(e,t){var n,r,o,u,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===u[0]||2===u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}},je=p()("rubick:server"),De=new be.a({prefix:"/api"});!function(e){for(var t=function(){var t=ve.shift();if(!t)return"continue";t.forEach(function(n){var r=n.handler,o=n.method,u=n.path,a=void 0===u?"":u;t.path&&"string"==typeof a&&(a=t.path+a),r=Array.isArray(r)?r:[r],o.forEach(function(t){var n;return(n=e)[t||W.GET].apply(n,[a].concat(r))})})};ve.length;)t()}(De);var qe=function(){return(qe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Ue=function(e,t,n,r){return new(n||(n=Promise))(function(o,u){function a(e){try{s(r.next(e))}catch(e){u(e)}}function i(e){try{s(r.throw(e))}catch(e){u(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,i)}s((r=r.apply(e,t||[])).next())})},Me=function(e,t){var n,r,o,u,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function i(u){return function(i){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===u[0]||2===u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}};l.a.languages([ce.Locale.ZH,ce.Locale.EN]);var Ve,Ye,Ke=p()("rubick:server"),Fe='<script src="/vendors.dll.'+pe(fe("dist/vendors.dll.manifest.json")).name.split("_")[1]+'.js"><\/script>',He=a.a.readFileSync(fe("dist/template.html"),"utf-8"),Be=new h.a;Be.keys=M(r.APP_KEYS,o.STR_ARR),Be.use(b()([O()(),E()(),g()(K,Be)])),function(e){var t=!!e,n=[he()(),De.routes(),De.allowedMethods(),function(e,t){return ke(void 0,void 0,void 0,function(){var n,r,o;return Le(this,function(u){switch(u.label){case 0:if(e.matched.length||!/^\/api/.test(e.url)||/\.[a-z]{2-4}\d?$/.test(e.path))return[3,4];u.label=1;case 1:return u.trys.push([1,3,,4]),[4,te({ctx:e})];case 2:return r=u.sent().result,e.body=r,[3,4];case 3:return n=u.sent(),r=n.result,o=n.status,e.body=r,e.status=o,[3,4];case 4:return[4,t()];case 5:return u.sent(),[2]}})})}];e||((e=new h.a).keys=M(r.APP_KEYS,o.STR_ARR),n.unshift(g()(K,e))),e.use(b()(n)),t||e.listen(le+1,"0.0.0.0",function(){je("Router server is now running at %s:%s.","0.0.0.0",le+1)})}(Be);Ye=a.a,Ve=function(e,t){return Object(k.createBundleRenderer)(e,qe({},t,{template:He,inject:!1,cache:_()({max:1e3,maxAge:9e5}),basedir:fe("dist/static"),runInNewContext:!1}))}(pe(fe("dist/vue-ssr-server-bundle.json")),{clientManifest:pe(fe("dist/vue-ssr-client-manifest.json"))});var Ge={};Be.use(T()("dist/static",{defer:!0})).use(A()("dist/static",{maxAge:31536e3},Ge)),Ge["/service-worker.js"].maxAge=0;var ze={"Content-Type":"text/html",Server:"koa/"+j.a.version+"; vue-server-renderer/"+q.a.version},Je=M(r.NON_SSR_PATTERN,o.STR_ARR),Ze=M(r.STATIC_PATTERN,o.STR_ARR);Be.use(function(e,t){return Ue(void 0,void 0,void 0,function(){var n,r,o,u,a,i,c,f,p,d,h,y,b;return Me(this,function(v){switch(v.label){case 0:return"GET"!==e.method||null!=e.body||404!==e.status||/(^\/api\/)|(\.[a-z]{2,4}\d?$)/.test(e.path)?[2,t()]:[4,void 0];case 1:return v.sent(),n=e.cookies.get("LOCALE_COOKIE"),r=n||l.a.get(e.get("Accept-Language")),n||e.cookies.set("LOCALE_COOKIE",r,{httpOnly:!1,path:"/",expires:new Date("Fri, 31 Dec 9999 23:59:59 GMT")}),e.set(ze),o=e.url,Je.find(function(e){return"*"===e||!!N()(e).exec(o)})?[3,2]:[3,5];case 2:return e.url="__non-ssr-page__.html",[4,t()];case 3:v.sent(),v.label=4;case 4:return[2];case 5:return Ze.find(function(e){return!!N()(e).exec(o)})?(i=o.split("?")[0].replace(/^\//,"")||"home",c=i+"."+r+".html",f=e.hostname.endsWith(".now.sh"),a=f?s.a.resolve("/tmp",c):fe("dist/static/"+c),Ye.existsSync(a)?f?(e.body=Ye.createReadStream(a),[3,8]):[3,6]:[3,9]):[3,10];case 6:return e.url=c,[4,t()];case 7:v.sent(),v.label=8;case 8:return Ke('using static html file "'+a+'"'),[2];case 9:u=!0,v.label=10;case 10:return p=Date.now(),d={ctx:e,locale:r,dllScript:Fe},h="",e.respond=!1,e.status=200,y=e.res,b=Ve.renderToStream(d).on("error",function(t){switch(e.status=t.status||500){case 302:return e.set({Location:t.url}),y.end();case 401:return e.redirect("/login?next="+o),y.end();case 404:return y.end("404 | Page Not Found");default:y.end("500 | Internal Server Error"),Ke("error during render : "+o),Ke(t.stack)}}).on("end",function(){if(h)try{w.a.sync(s.a.dirname(a),{fs:Ye}),Ye.writeFileSync(a,h),Ke('static html file "'+a+'" is generated')}catch(e){Ke(e)}Ke("whole request: "+(Date.now()-p)+"ms")}),u&&b.on("data",function(e){return h+=e}),b.pipe(y),[2]}})})}),Be.listen(le,"0.0.0.0",function(){return Ke("Server is now running at %s:%s.","0.0.0.0",le)})}]);